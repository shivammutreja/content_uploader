
{% extends "new_ck.html" %}

{% block choices %}

<!-- Content Editor -->

<div class="container-fluid">

<form method="post">
{% if not content %}
    <textarea cols="10" id="editor1" name="editor1" rows="10" >&nbsp;Write the Question here!
{% else %}
    <textarea cols="10" id="editor1" name="editor1" rows="10" >{{content}}
{% end if %}
    </textarea>
    <input type="submit" />
</form>



<!-- Choices or Images  -->

{% if not images %}
<p id="image_path"></p>
    <div class="row">
        <form id="form-test" enctype="multipart/form-data" runat="server">

            <div class="col-sm-4">
                Enter Choice 1: <input type="text" placeholder="Choice 1" name="choice1" />
            </div>

            <div class="col-sm-8">
                    <input type='file' name="get_image" id="imgInp" multiple/><br />
                    <img id="blah" style="display:none" alt="your image" />
                    <button class="btn btn-sm btn-primary">Upload</button>
            </div>

        </form>
    </div>
{% else %}

{% for index,image in enumerate(images) %}
<p id="image_path"></p>
<div class="row">
    <div class="col-sm-4">
        Choice {{index + 1}}: <input name="choice{{index + 1}}" type="text" value="{{image}}" />
    </div>
    <div class="col-sm-4">    
        <img src="{{image}}" height="100px" width="100px" alt="your image" />
    </div>
    <div class="col-sm-4">
        <button name="choice{{index + 1}}" class="btn btn-sm btn-primary" onclick="myFunction(this);">Edit</button>
    </div>
</div>
{% end for %}

{% if choice_inputs %}
    {% for input_index in range(2, choice_inputs+2) %}
    <div class="row">
        <form id="form-test" enctype="multipart/form-data" runat="server">

            <div class="col-sm-4">
                Enter Choice {{input_index}}: <input type="text" placeholder="Choice {{input_index}}" name="choice{{input_index}}" />
            </div>

            <div class="col-sm-8">
                <input type='file' name="get_image" id="imgInp" multiple/><br />
                <img id="blah" style="display:none" alt="your image" />
                <button class="btn btn-sm btn-primary" id="click" >Upload</button>
            </div>

        </form>
        
    </div>
    {% end for %}

{% end if %}

{% end if %}

</div>

    <script>
    $(document).ready(function(){
        function readURL(input) {
            if (input.files && input.files[0]) {
                var reader = new FileReader();
                console.log(reader);
            
                reader.onload = function (e) {
                    $('#blah').attr('src', e.target.result);
                    // $('.get_data').data(e.target.result);
                    $('#blah').css({'height': '100px', 'width': '100px','display': 'inline'});
                }

            
                reader.readAsDataURL(input.files[0]);
            }
        }
    
        $("#imgInp").change(function(){
            readURL(this);
        });

        // $("#click").click(function() {
        //     var form_data = new FormData($('#form-test')[0]);
        //     console.log(form_data);
        // });
    });

    </script>


    <script>
        $("#form-test").submit(function(evt){
            evt.preventDefault();
            var formData = new FormData($(this)[0]);

        $.ajax({
           url: '/file',
           type: 'POST',
           data: formData,
           async: false,
           cache: false,
           contentType: false,
           enctype: 'multipart/form-data',
           processData: false,
           success: function (data) {
             console.log(data.image_id);
             $("#image_path").html(data.image_id)
            }
        });
        return false;
        });

    </script>

    <script>
    CKEDITOR.replace( 'editor1', {
          height: 300,

          // filebrowserImageBrowseUrl: "/find",

          // filebrowserImageUploadUrl: "/file"
    } );
    
    if ( CKEDITOR.env.ie && CKEDITOR.env.version == 8 ) {
        document.getElementById( 'ie8-warning' ).className = 'tip alert';
    }
    </script>


    <script>
        function myFunction(button_id) {
            console.log(button_id.name);
        window.open("/find", "_blank", "toolbar=yes,scrollbars=yes,resizable=yes,top=500,left=500,width=400,height=400");
        }
        // var choice_id = 
    </script>

    <script>

    function ajaxSubmit() {
        // console.log($("#imgInp"));
        // var img_data = $("#blah").attr("src")
        // var img_title = $("#imgInp").val();

        // console.log($("form")[0]);
        // alert(img_title);
        var form_data = $('#form-test').serialize()
        // new FormData($('#form-test')[0]);
        console.log(form_data);

        // $.ajax({
        //     type: "POST",
        //     url: "/file",
        //     // data: {"img_data": img_data,
        //     //         "img_title": img_title},
        //     data: {"form_data": form_data},
        //     success: function(response) {
        //         alert(response);
        //         if(response == "Successful")
        //             {
        //             alert(image);
        //             // $("#image_path").innerHtml(image.image_id)
        //             // $('form').removeAttr('onsubmit'); // prevent endless loop
        //             // $('form').submit();
        //         }
        //     }
        // });
    }
    
    </script>

{% end block %}
